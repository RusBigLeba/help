<!DOCTYPE html>
<html lang="en" style="background-color: black;">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="description" content="Build Your Own Botnet"/>
    <meta name="author" content=""/>

    <link rel="icon" href="/assets/images/BotIM-icon-square.png">

    {% if title %}
    <title>{{ title }}</title>
    {% else %}
    <title>Botnet Intelligent Manager</title>
    {% endif %}

    <link rel="stylesheet" href="/assets/js/jquery-ui/css/no-theme/jquery-ui-1.10.3.custom.min.css">
    <link rel="stylesheet" href="/assets/css/font-icons/entypo/css/entypo.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic">
    <link rel="stylesheet" href="/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/assets/css/neon-core.css">
    <link rel="stylesheet" href="/assets/css/neon-theme.css">
    <link rel="stylesheet" href="/assets/css/neon-forms.css">
    <link rel="stylesheet" href="/assets/css/custom.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <script src="/assets/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="/assets/js/easy-pie-chart/dist/jquery.easypiechart.js"></script>


    <!-- 	<link rel="stylesheet"type="text/css" href="/path/to/jquery.easy-pie-chart.css"> -->


    <!--[if lt IE 9]>
    <script src="/assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


</head>

<body class="page-body" style="background-color: transparent;">

<div class="page-container horiztontal-menu" style="background-color: transparent;">

    <header class="navbar navbar-fixed-top logo-env">
        <nav class="navbar navbar-inverse" role="navigation"
             style="width: 100%; height: 10%; background-color: black; padding-top:5px; padding-left: 25px; padding-right: 25px; padding-bottom: 5px;">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-2">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="logo">
                    <a href="/">
                        <img src="/assets/images/BotIM-icon-rectangle-big.png" width="120" alt=""
                             style="padding-top: 15px; padding-right: 10px"/>
                    </a>
                </div>
            </div>

            <!-- Left side of navbar -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">

                <!-- Main menu -->
                <ul class="nav navbar-nav">
                    <li class="has-sub">
                        <a href="/sessions">
                            Control Panel
                        </a>
                    </li>
                    <li class="has-sub">
                        <a href="/payloads">
                            Payloads
                        </a>
                    </li>
                    <li class="has-sub">
                        <a href="/files">
                            Exfiltrated Files
                        </a>
                    </li>
                    <li class="has-sub">
                        <a href="/sessions">
                            Sessions
                        </a>
                    </li>
                </ul>

                <!-- Right side of navbar -->
                <ul class="nav navbar-nav navbar-right" style="padding-right: 20px">
                    <!-- Profile Info -->
                    <li>
                        <a href="{{ url_for('users.account') }}">
                            Edit Account
                        </a>
                    </li>
                    <li>
                        <a href="/logout">
                            Log Out
                        </a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </nav>
    </header>
    <div class="main-content">

        <div class="row" style="z-index: 1; position: absolute; top: 0; left: 50%; transform: translate(-50%, -50%);">
            <div class="col-md-8">
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                </div>
                {% endfor %}
                {% endif %}
                {% endwith %}

            </div>
        </div>
        <div class="container"
             style="z-index: 1; position: absolute; top: 80%; left: 50%; transform: translate(-50%, -500px);">

            <h1 align="center" style="color: white;">Current Sessions</h1>

            <hr/>
            <br/>

            <!-- sessions table -->
            <div class="row">

                <!-- Table sorting and search functions -->
                <script type="text/javascript">
                    jQuery(document).ready(function ($) {
                        var $table3 = jQuery("#sessions-table");

                        var table3 = $table3.DataTable({
                            "aLengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
                        });

                        // Initalize Select Dropdown after DataTables is created
                        $table3.closest('.dataTables_wrapper').find('select').select2({
                            minimumResultsForSearch: -1
                        });

                        // Apply the search
                        table3.columns().every(function () {
                            var that = this;

                            $('input', this.header()).on('keyup change', function () {
                                if (that.search() !== this.value) {
                                    that
                                        .search(this.value)
                                        .draw();
                                }
                            });
                        });
                    });
                </script>

                <!-- Action functions -->
                <script>
                    function getTasks(element) {
                        location.href = "/tasks?session_uid=" + element.getAttribute('name');
                    }

                    function launchSession(element) {
                        location.href = "/shell?session_uid=" + element.getAttribute('name');
                    }

                    function removeSession(element) {
                        $.post("{{ url_for('session.session_remove') }}", {session_uid: element.getAttribute('name')},
                            function (response) {
                                // remove session row from table
                                $('#session-row-' + element.getAttribute('name')).remove();
                                // decrement bots count
                                var nbots = $('#nbots').text();
                                nbots = parseInt(nbots) - 1;
                                $('#nbots').text(nbots);
                                toastr.error('Session removed');
                            });
                    }

                    function checkSessions(element) {
                        for (var i = 0; i < element.length; i++) {
                            let session = element[i];

                            if (session.online) {
                            } else {
                                $.post("{{ url_for('session.session_remove') }}", {session_uid: session.uid},
                                    function (response) {
                                        // remove session row from table
                                        $('#session-row-' + session.uid).remove();
                                        // decrement bots count
                                        var nbots = $('#nbots').text();
                                        nbots = parseInt(nbots) - 1;
                                        $('#nbots').text(nbots);
                                        toastr.error('Session disconnected');
                                        location.reload()
                                    });
                            }
                        }
                    }
                </script>


                <!-- Poll server for new sessions -->
                <script>

                    $('#sessions-table-body tr:first').remove();

                    const sleep = (milliseconds) => {
                        return new Promise(resolve => setTimeout(resolve, milliseconds))
                    }

                    const pollServer = async () => {
                        while (true) {
                            await sleep(1000);
                            checkSessions({{ sessions | tojson }})
                            $.getJSON('/api/session/poll', function (data) {
                                try {
                                    if (data.length > 0) {

                                        for (var i = 0; i < data.length; i++) {

                                            let session = data[i];

                                            // Notify user of new session
                                            var notification = toastr.success('New connection from ' + session.public_ip);

                                            $(notification).click(function () {
                                                location.href = '/sessions';
                                            });

                                            // let row = `<tr style="background-color: white; color: grey;" id="session-row-` + session.uid + `">

                                            // 		<!-- Check box -->
                                            // 		<td class="text-center">
                                            // 			<div class="checkbox checkbox-replace color-blue" style="text-align: center; vertical-align: middle;">
                                            // 				<input type="checkbox" id="chk-`+session.uid+`">
                                            // 			</div>
                                            // 		</td>

                                            // 		<!-- Status icon -->
                                            // 		<td style="text-align: center; vertical-align: middle;">
                                            // 			<i class="fa fa-wifi" style="color: green; opacity: 1.0; text-align: center;" id="status-` + session.uid + `"></i>
                                            // 		</td>

                                            // 		<!-- Session ID -->
                                            // 		<td style="text-align: center; vertical-align: middle;">` + session.uid + `</td>

                                            // 		<!-- Public IP -->
                                            // 		<td style="text-align: center; vertical-align: middle;">` + session.public_ip + `</td>

                                            // 		<!-- Platform icon -->
                                            // 		<td style="text-align: center; vertical-align: middle;">
                                            // 			<img src="/assets/images/os/` + session.platform + `.png" width="30" height="30" style="padding-right: 5px">`;

                                            // 		if (session.platform == 'win32') {
                                            // 			row += ' Windows';
                                            // 		} else if (session.platform == 'darwin') {
                                            // 			row += ' OS X';
                                            // 		} else {
                                            // 			row += 'Linux';
                                            // 		}

                                            // 		row += `</td>

                                            // 		<!-- Hashes/second -->
                                            // 		<td id="peity-right-now-` + session.uid + `">0 H/s
                                            // 		</td>

                                            // 		<!-- Hash rate Graph -->
                                            // 		<td>
                                            // 			<span class="updating-chart" id="hashrate-graph-` + session.uid + `">0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ,0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0</span>
                                            // 		</td>

                                            // 		<!-- Terminal button -->
                                            // 		<td style="text-align: center; vertical-align: middle;">
                                            // 			<button class="terminal-button" name="` + session.uid + `" onclick="launchSession(this)"><i class="fa fa-terminal terminal-icon"></i></button>
                                            // 		</td>

                                            // 		<!-- History button -->
                                            // 		<td style="text-align: center; vertical-align: middle;">
                                            // 			<button class="terminal-button" name="` + session.uid + `" onclick="getTasks(this)"><i class="entypo-list terminal-icon"></i></button>
                                            // 		</td>

                                            // 		<!-- Remove button -->
                                            // 		<td style="text-align: center; vertical-align: middle;">
                                            // 			<button class="terminal-button" name="` + session.uid + `" onclick="removeSession(this)"><i class="entypo-trash terminal-icon"></i></button>
                                            // 		</td>
                                            // 	</tr>`

                                            // // Update sessions table
                                            // $('#sessions-table-body tr').after(row);


                                            // add peity chart
                                            //$("#hashrate-graph-" + session.uid).peity("line", { width: 150});

                                        }
                                    }
                                } catch (e) {
                                    console.error(e);
                                }
                            });
                        }
                    }

                    pollServer();
                </script>


                <!-- Sessions table -->
                <table class="table table-bordered datatable" id="sessions-table" style="opacity: 1.0;">

                    <!-- Column headers -->
                    <thead>
                    <tr class="replace-inputs">

                        <!-- Select button -->
                        <th style="color: black; text-align: center; vertical-align: middle;" onclick="selectVisible()">
                            Select
                        </th>

                        <!-- Status (online/offline) -->
                        <th style="color: black;"><input type="text" class="form-control" placeholder="Status"/></th>

                        <!-- ID -->
                        <th style="color: black;" width="10%"><input type="text" class="form-control" placeholder="ID"/>
                        </th>

                        <!-- IP Address -->
                        <th style="color: black;"><input type="text" class="form-control" placeholder="IP Address"/>
                        </th>

                        <!-- Platform -->
                        <th style="color: black;"><input type="text" class="form-control" placeholder="Platform"/></th>


                        <!-- Info buttons -->
                        <th style="color: black; text-align: center; vertical-align: middle;">Info</th>

                        <!-- Shell buttons -->
                        <th style="color: black; text-align: center; vertical-align: middle;">Shell</th>

                        <!-- Results buttons -->
                        <th style="color: black; text-align: center; vertical-align: middle;">History</th>

                        <!-- Kill buttons -->
                        <th style="color: black; text-align: center; vertical-align: middle;">Remove</th>
                    </tr>
                    </thead>
                    <tbody id="sessions-table-body">
                    {% for session in sessions %}
                    <tr style="background-color: white; color: grey; font-size: 14px"
                        id="session-row-{{ session['uid'] }}">

                        <!-- Check box -->
                        <td style="text-align: center; vertical-align: middle;">
                            <div class="checkbox checkbox-replace color-blue">
                                <input type="checkbox" id="chk-{{ session['uid'] }}">
                            </div>
                        </td>

                        <!-- Status icon -->
                        <td style="text-align: center; vertical-align: middle;" width="15%">
                            {% if session['online'] %}
                            <i class="fa fa-wifi" style="color: green; text-align: center; vertical-align: middle;"
                               id="status-{{ session['uid'] }}"></i><span id="online-{{ session['uid']}}"
                                                                          style="color: gray;"> Online</span>
                            {% else %}
                            <i class="fa fa-wifi" style="color: gray; text-align: center; vertical-align: middle;"
                               id="status-{{ session['uid'] }}"></i><span style="color: gray;"> Offline</span>
                            {% endif %}
                        </td>


                        <!-- Session ID -->
                        <td style="text-align: center; vertical-align: middle;" width="10%">{{ session['id'] }}</td>

                        <!-- Public IP -->
                        <td id="session-{{ session['uid'] }}-ip" style="text-align: center; vertical-align: middle;"
                            width="20%">{{ session['public_ip'] }}
                        </td>

                        <!-- Platform icon -->
                        <td style="text-align: center; vertical-align: middle;" width="15%">
                            <img src="/assets/images/os/{{ session['platform'] }}.png" width="30" height="30"
                                 style="padding: 2px">
                            {% if session['platform'] == 'win32' %}
                            <!-- <i class="fa fa-windows" style="font-size: medium;">  -->Windows
                            {% elif session['platform'] == 'darwin' %}
                            <!-- <i class="fa fa-apple" style="font-size: medium;">  -->OS X
                            {% else %}
                            <!-- <i class="fa fa-linux" style="font-size: medium;"> --> Linux
                            {% endif %}
                        </td>

                        {#                            <!-- Hashes/second -->#}
                        {#
                        <td id="peity-right-now-{{ session['uid'] }}">0 H/s#}
                            {#
                        </td>
                        #}

                        {#                            <!-- Hash rate Graph -->#}
                        {#
                        <td>#}
                            {# <span class="updating-chart" id="hashrate-graph-{{ session['uid'] }}">0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ,0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0</span>#}
                            {#
                        </td>
                        #}


                        <!-- History button -->
                        <td class="text-center">
                            <button class="terminal-button session-row-icon" name="{{ session['uid'] }}"
                                    onclick="showInfo(this)"><i class="fa fa-info-circle terminal-icon"></i></button>
                        </td>


                        <!-- Terminal button -->
                        <td class="text-center">
                            {% if session['online'] %}
                            <img class="session-row-icon" src="/assets/images/iconfinder_terminal.png" width="30"
                                 height="30" style="padding: 2px" name="{{ session['uid'] }}"
                                 onclick="launchSession(this)">
                            {% else %}
                            <img class="session-row-icon" src="/assets/images/iconfinder_terminal.png" width="30"
                                 height="30" style="padding: 2px" name="{{ session['uid'] }}"
                                 onclick="alert('Bot is offline.')">
                            {% endif %}
                        </td>

                        <!-- History button -->
                        <td class="text-center">
                            <button class="terminal-button session-row-icon" name="{{ session['uid'] }}"
                                    onclick="getTasks(this)"><i class="entypo-list terminal-icon"></i></button>
                        </td>

                        <!-- Remove button -->
                        <td class="text-center">
                            <button class="terminal-button session-row-icon" name="{{ session['uid'] }}"
                                    onclick="removeSession(this)"><i class="entypo-trash terminal-icon"></i></button>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <!-- Client info modas -->
                {% for session in sessions %}
                <div class="modal fade" id="info-modal-{{ session['uid'] }}"
                     style="height: 500px; position: absolute; top: 500px; left: 33%">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;
                                </button>
                                <h4 class="modal-title">Bot Information</h4>
                            </div>

                            <div class="modal-body">
                                <table class="table table-bordered responsive" id="info-table-{{ session['uid'] }}">
                                    {% for key, value in session.items() %}
                                    <tr>
                                        <td><strong>{{key}}</strong></td>
                                        <td>{{value}}</td>
                                    </tr>
                                    {% endfor %}
                                </table>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <br/>
            <hr/>
            <br/>
        </div>
    </div>


    <!-- Imported styles on this page -->
    <link rel="stylesheet" href="/assets/js/jvectormap/jquery-jvectormap-1.2.2.css">
    <link rel="stylesheet" href="/assets/js/rickshaw/rickshaw.min.css">

    <!-- Bottom scripts (common) -->
    <script src="/assets/js/gsap/TweenMax.min.js"></script>
    <script src="/assets/js/jquery-ui/js/jquery-ui-1.10.3.minimal.min.js"></script>
    <script src="/assets/js/bootstrap.js"></script>
    <script src="/assets/js/joinable.js"></script>
    <script src="/assets/js/resizeable.js"></script>
    <script src="/assets/js/neon-api.js"></script>
    <script src="/assets/js/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>


    <!-- Imported scripts on this page -->
    <script src="/assets/js/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="/assets/js/jquery.sparkline.min.js"></script>
    <script src="/assets/js/rickshaw/vendor/d3.v3.js"></script>
    <script src="/assets/js/rickshaw/rickshaw.min.js"></script>
    <script src="/assets/js/raphael-min.js"></script>
    <script src="/assets/js/morris.min.js"></script>
    <script src="/assets/js/toastr.js"></script>
    <script src="/assets/js/neon-chat.js"></script>


    <!-- JavaScripts initializations and stuff -->
    <script src="/assets/js/neon-custom.js"></script>
    <script src="/assets/js/custom/canvas-init.js"></script>

    <!-- Demo Settings -->
    <script src="/assets/js/neon-demo.js"></script>

    <!-- Imported styles on this page -->
    <link rel="stylesheet" href="/assets/js/datatables/datatables.css">
    <link rel="stylesheet" href="/assets/js/select2/select2-bootstrap.css">
    <link rel="stylesheet" href="/assets/js/select2/select2.css">
    <link rel="stylesheet" href="/assets/js/selectboxit/jquery.selectBoxIt.css">
    <link rel="stylesheet" href="/assets/js/daterangepicker/daterangepicker-bs3.css">
    <link rel="stylesheet" href="/assets/js/icheck/skins/minimal/_all.css">
    <link rel="stylesheet" href="/assets/js/icheck/skins/square/_all.css">
    <link rel="stylesheet" href="/assets/js/icheck/skins/flat/_all.css">
    <link rel="stylesheet" href="/assets/js/icheck/skins/futurico/futurico.css">
    <link rel="stylesheet" href="/assets/js/icheck/skins/polaris/polaris.css">

    <!-- Bottom scripts (common) -->
    <script src="assets/js/gsap/TweenMax.min.js"></script>
    <script src="assets/js/jquery-ui/js/jquery-ui-1.10.3.minimal.min.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/joinable.js"></script>
    <script src="assets/js/resizeable.js"></script>
    <script src="assets/js/neon-api.js"></script>
    <script src="/assets/js/selectboxit/jquery.selectBoxIt.min.js"></script>


    <!-- Imported scripts on this page -->
    <script src="/assets/js/datatables/datatables.js"></script>
    <script src="/assets/js/select2/select2.min.js"></script>
    <script src="/assets/js/bootstrap-tagsinput.min.js"></script>
    <script src="/assets/js/typeahead.min.js"></script>
    <script src="/assets/js/bootstrap-datepicker.js"></script>
    <script src="/assets/js/bootstrap-timepicker.min.js"></script>
    <script src="/assets/js/bootstrap-colorpicker.min.js"></script>
    <script src="/assets/js/moment.min.js"></script>
    <script src="/assets/js/daterangepicker/daterangepicker.js"></script>
    <script src="/assets/js/jquery.multi-select.js"></script>
    <script src="/assets/js/icheck/icheck.min.js"></script>

    <script src="/assets/js/jquery.peity.min.js"></script>


    <!-- JavaScripts initializations and stuff -->
    <script src="assets/js/neon-custom.js"></script>

    <script>

        function showInfo(element) {
            var session_uid = element.getAttribute('name');

            jQuery('#info-modal-' + session_uid).modal('show');

            // $('#info-table-' + session_uid).slideToggle();
        }


        function selectAll() {
            var sessions = $('[id^="chk"]');
            for (var i = 0; i < sessions.length; i++) {
                var session = sessions[i];
                session.click();
            }
        }
    </script>

    <script>
        $(document).ready(function () {
            // hide miner options
            $('#miner-label').hide();
            $('#miner').hide();

            // hide webcam options
            $('#webcam-label').hide();
            $('#webcam').hide();

            // hide keylogger options
            $('#keylogger-label').hide();
            $('#keylogger').hide();

            // hide packetsniffer options
            $('#packetsniffer-label').hide();
            $('#packetsniffer').hide();

            // hide portscanner options
            $('#portscanner-label').hide();
            $('#portscanner').hide();

            // hide process control options
            $('#process-label').hide();
            $('#process').hide();
        });

        $(document).ready(function () {
            $('#module').selectBoxIt().change(function () {
                updateModule();
            });
        });

        $(document).ready(function () {
            $('#sessions-table_length').after(`<caption id="sessions-title" align="center" style="position: absolute; float: center; left: 45%; transform: translateY(-18%);"><h3 class="titillium">Bots: <span class="titillium" id="nbots">{{n}}</span></h3></caption>`);
        });

        $(document).ready(function () {
            var sessions = $('[id^="session-row"]');

            for (var i = 0; i < sessions.length; i++) {
                // get session uid
                var session = sessions[i];
                var uid = session.getAttribute('id').split('-')[2];

                // hide info modals
                $('#info-modal-' + uid).hide();

                // create peity charts
                    {
                        #var
                        updatingChart = $("#hashrate-graph-" + uid).peity("line", {width: 150});
                    #
                    }
                }
            }
        )
            ;

    </script>




    <script>
        window.addEventListener("hashchange", function () {
            window.scrollTo(window.scrollX, window.scrollY - 100);
        });
    </script>
</div>
>
</body>

</html>

